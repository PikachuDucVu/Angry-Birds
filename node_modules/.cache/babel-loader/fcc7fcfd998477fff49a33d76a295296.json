{"ast":null,"code":"import _initializerDefineProperty from\"D:/projects/test-game/node_modules/@babel/runtime/helpers/esm/initializerDefineProperty.js\";import _classCallCheck from\"D:/projects/test-game/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"D:/projects/test-game/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"D:/projects/test-game/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"D:/projects/test-game/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"D:/projects/test-game/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import _applyDecoratedDescriptor from\"D:/projects/test-game/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor.js\";import _initializerWarningHelper from\"D:/projects/test-game/node_modules/@babel/runtime/helpers/esm/initializerWarningHelper.js\";var _dec,_dec2,_dec3,_dec4,_dec5,_dec6,_dec7,_class,_descriptor,_descriptor2,_descriptor3,_descriptor4,_descriptor5,_descriptor6,_descriptor7;import{System,Inject}from\"flat-ecs\";import{TextureRegion,Animation,PlayMode}from\"gdxts\";import{Constants}from\"../Constants\";export var BoxesAndPigsRenderSystem=(_dec=Inject(\"gl\"),_dec2=Inject(\"assetManager\"),_dec3=Inject(\"batch\"),_dec4=Inject(\"boxes\"),_dec5=Inject(\"pigs\"),_dec6=Inject(\"physicWorld\"),_dec7=Inject(\"levelState\"),(_class=/*#__PURE__*/function(_System){_inherits(BoxesAndPigsRenderSystem,_System);var _super=_createSuper(BoxesAndPigsRenderSystem);function BoxesAndPigsRenderSystem(){var _this;_classCallCheck(this,BoxesAndPigsRenderSystem);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.boxAsset=void 0;_this.pigAsset=void 0;_this.boxRegions=void 0;_this.pigRegions=void 0;_this.boxAnimation=void 0;_this.pigAnimation=void 0;_initializerDefineProperty(_this,\"gl\",_descriptor,_assertThisInitialized(_this));_initializerDefineProperty(_this,\"assetManager\",_descriptor2,_assertThisInitialized(_this));_initializerDefineProperty(_this,\"batch\",_descriptor3,_assertThisInitialized(_this));_initializerDefineProperty(_this,\"boxes\",_descriptor4,_assertThisInitialized(_this));_initializerDefineProperty(_this,\"pigs\",_descriptor5,_assertThisInitialized(_this));_initializerDefineProperty(_this,\"physicWorld\",_descriptor6,_assertThisInitialized(_this));_initializerDefineProperty(_this,\"levelState\",_descriptor7,_assertThisInitialized(_this));return _this;}_createClass(BoxesAndPigsRenderSystem,[{key:\"initialized\",value:function initialized(){this.boxAsset=this.assetManager.getTexture(\"boxAsset\");this.pigAsset=this.assetManager.getTexture(\"pigAsset\");var boxesRegions=TextureRegion.splitTexture(this.boxAsset,1,4);var pigTexture=TextureRegion.splitTexture(this.pigAsset,2,1);this.boxAnimation=new Animation(boxesRegions.slice(0,4),Constants.frameDuration);this.pigAnimation=new Animation(pigTexture.slice(0,2),Constants.frameDuration);this.boxRegions=[this.boxAnimation.getKeyFrame(0,PlayMode.NORMAL),this.boxAnimation.getKeyFrame(0,PlayMode.NORMAL),this.boxAnimation.getKeyFrame(0,PlayMode.NORMAL),this.boxAnimation.getKeyFrame(0,PlayMode.NORMAL),this.boxAnimation.getKeyFrame(0,PlayMode.NORMAL),this.boxAnimation.getKeyFrame(0,PlayMode.NORMAL)];this.pigRegions=[this.pigAnimation.getKeyFrame(0,PlayMode.NORMAL),this.pigAnimation.getKeyFrame(0,PlayMode.NORMAL)];}},{key:\"process\",value:function process(){var _this2=this;var updateBoxRegionByDurability=function updateBoxRegionByDurability(index,durability){_this2.boxRegions[index]=_this2.boxAnimation.getKeyFrame(Constants.frameDuration*durability,PlayMode.NORMAL);};var updatePigRegionByDurability=function updatePigRegionByDurability(index,durability){_this2.pigRegions[index]=_this2.pigAnimation.getKeyFrame(Constants.frameDuration*durability,PlayMode.NORMAL);};for(var i=0;i<this.boxes.length;i++){if(typeof this.boxes[i].GetUserData().durability===\"number\"){if(this.boxes[i].GetUserData().durability<=4){updateBoxRegionByDurability(i,this.boxes[i].GetUserData().durability);}}}for(var _i=0;_i<this.pigs.length;_i++){if(typeof this.pigs[_i].GetUserData().durability===\"number\"){if(this.pigs[_i].GetUserData().durability<=1){updatePigRegionByDurability(_i,this.pigs[_i].GetUserData().durability);}}}this.batch.begin();for(var _i2=0;_i2<this.boxes.length;_i2++){this.boxRegions[_i2].draw(this.batch,this.boxes[_i2].GetPosition().x*Constants.METER_TO_WORLD-Constants.BOX_SIZE*Constants.METER_TO_WORLD/2,this.boxes[_i2].GetPosition().y*Constants.METER_TO_WORLD-Constants.BOX_SIZE*Constants.METER_TO_WORLD/2,Constants.BOX_SIZE*Constants.METER_TO_WORLD,Constants.BOX_SIZE*Constants.METER_TO_WORLD);}for(var _i3=0;_i3<this.pigs.length;_i3++){this.pigRegions[_i3].draw(this.batch,this.pigs[_i3].GetPosition().x*Constants.METER_TO_WORLD-Constants.PIG_SIZE*Constants.METER_TO_WORLD/2,this.pigs[_i3].GetPosition().y*Constants.METER_TO_WORLD-Constants.PIG_SIZE*Constants.METER_TO_WORLD/2,Constants.PIG_SIZE*Constants.METER_TO_WORLD,Constants.PIG_SIZE*Constants.METER_TO_WORLD);}this.batch.end();}}]);return BoxesAndPigsRenderSystem;}(System),(_descriptor=_applyDecoratedDescriptor(_class.prototype,\"gl\",[_dec],{configurable:true,enumerable:true,writable:true,initializer:null}),_descriptor2=_applyDecoratedDescriptor(_class.prototype,\"assetManager\",[_dec2],{configurable:true,enumerable:true,writable:true,initializer:null}),_descriptor3=_applyDecoratedDescriptor(_class.prototype,\"batch\",[_dec3],{configurable:true,enumerable:true,writable:true,initializer:null}),_descriptor4=_applyDecoratedDescriptor(_class.prototype,\"boxes\",[_dec4],{configurable:true,enumerable:true,writable:true,initializer:null}),_descriptor5=_applyDecoratedDescriptor(_class.prototype,\"pigs\",[_dec5],{configurable:true,enumerable:true,writable:true,initializer:null}),_descriptor6=_applyDecoratedDescriptor(_class.prototype,\"physicWorld\",[_dec6],{configurable:true,enumerable:true,writable:true,initializer:null}),_descriptor7=_applyDecoratedDescriptor(_class.prototype,\"levelState\",[_dec7],{configurable:true,enumerable:true,writable:true,initializer:null})),_class));","map":{"version":3,"names":["System","Inject","TextureRegion","Animation","PlayMode","Constants","BoxesAndPigsRenderSystem","boxAsset","pigAsset","boxRegions","pigRegions","boxAnimation","pigAnimation","assetManager","getTexture","boxesRegions","splitTexture","pigTexture","slice","frameDuration","getKeyFrame","NORMAL","updateBoxRegionByDurability","index","durability","updatePigRegionByDurability","i","boxes","length","GetUserData","pigs","batch","begin","draw","GetPosition","x","METER_TO_WORLD","BOX_SIZE","y","PIG_SIZE","end"],"sources":["D:/projects/test-game/src/system/BoxesAndPigsRenderSystem.ts"],"sourcesContent":["import { b2Body, b2World } from \"box2d.ts\";\r\nimport { System, Inject } from \"flat-ecs\";\r\nimport {\r\n  AssetManager,\r\n  PolygonBatch,\r\n  Texture,\r\n  TextureRegion,\r\n  Animation,\r\n  PlayMode,\r\n} from \"gdxts\";\r\nimport { Constants } from \"../Constants\";\r\nimport { LevelState } from \"../data/LevelState\";\r\nexport class BoxesAndPigsRenderSystem extends System {\r\n  boxAsset: Texture;\r\n  pigAsset: Texture;\r\n  boxRegions: TextureRegion[];\r\n  pigRegions: TextureRegion[];\r\n  boxAnimation: any;\r\n  pigAnimation: any;\r\n\r\n  @Inject(\"gl\") gl: WebGLRenderingContext;\r\n  @Inject(\"assetManager\") assetManager: AssetManager;\r\n  @Inject(\"batch\") batch: PolygonBatch;\r\n  @Inject(\"boxes\") boxes: b2Body[];\r\n  @Inject(\"pigs\") pigs: b2Body[];\r\n  @Inject(\"physicWorld\") physicWorld: b2World;\r\n  @Inject(\"levelState\") levelState: LevelState;\r\n\r\n  initialized(): void {\r\n    this.boxAsset = this.assetManager.getTexture(\"boxAsset\") as Texture;\r\n    this.pigAsset = this.assetManager.getTexture(\"pigAsset\") as Texture;\r\n    const boxesRegions = TextureRegion.splitTexture(this.boxAsset, 1, 4);\r\n    const pigTexture = TextureRegion.splitTexture(this.pigAsset, 2, 1);\r\n    this.boxAnimation = new Animation(\r\n      boxesRegions.slice(0, 4),\r\n      Constants.frameDuration\r\n    );\r\n    this.pigAnimation = new Animation(\r\n      pigTexture.slice(0, 2),\r\n      Constants.frameDuration\r\n    );\r\n    this.boxRegions = [\r\n      this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n      this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n      this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n      this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n      this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n      this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n    ];\r\n    this.pigRegions = [\r\n      this.pigAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n      this.pigAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n    ];\r\n  }\r\n\r\n  process(): void {\r\n    const updateBoxRegionByDurability = (index: number, durability: number) => {\r\n      this.boxRegions[index] = this.boxAnimation.getKeyFrame(\r\n        Constants.frameDuration * durability,\r\n        PlayMode.NORMAL\r\n      );\r\n    };\r\n    const updatePigRegionByDurability = (index: number, durability: number) => {\r\n      this.pigRegions[index] = this.pigAnimation.getKeyFrame(\r\n        Constants.frameDuration * durability,\r\n        PlayMode.NORMAL\r\n      );\r\n    };\r\n\r\n    for (let i = 0; i < this.boxes.length; i++) {\r\n      if (typeof this.boxes[i].GetUserData().durability === \"number\") {\r\n        if (this.boxes[i].GetUserData().durability <= 4) {\r\n          updateBoxRegionByDurability(\r\n            i,\r\n            this.boxes[i].GetUserData().durability\r\n          );\r\n        }\r\n      }\r\n    }\r\n    for (let i = 0; i < this.pigs.length; i++) {\r\n      if (typeof this.pigs[i].GetUserData().durability === \"number\") {\r\n        if (this.pigs[i].GetUserData().durability <= 1) {\r\n          updatePigRegionByDurability(i, this.pigs[i].GetUserData().durability);\r\n        }\r\n      }\r\n    }\r\n\r\n    this.batch.begin();\r\n    for (let i = 0; i < this.boxes.length; i++) {\r\n      this.boxRegions[i].draw(\r\n        this.batch,\r\n        this.boxes[i].GetPosition().x * Constants.METER_TO_WORLD -\r\n          (Constants.BOX_SIZE * Constants.METER_TO_WORLD) / 2,\r\n        this.boxes[i].GetPosition().y * Constants.METER_TO_WORLD -\r\n          (Constants.BOX_SIZE * Constants.METER_TO_WORLD) / 2,\r\n        Constants.BOX_SIZE * Constants.METER_TO_WORLD,\r\n        Constants.BOX_SIZE * Constants.METER_TO_WORLD\r\n      );\r\n    }\r\n    for (let i = 0; i < this.pigs.length; i++) {\r\n      this.pigRegions[i].draw(\r\n        this.batch,\r\n        this.pigs[i].GetPosition().x * Constants.METER_TO_WORLD -\r\n          (Constants.PIG_SIZE * Constants.METER_TO_WORLD) / 2,\r\n        this.pigs[i].GetPosition().y * Constants.METER_TO_WORLD -\r\n          (Constants.PIG_SIZE * Constants.METER_TO_WORLD) / 2,\r\n        Constants.PIG_SIZE * Constants.METER_TO_WORLD,\r\n        Constants.PIG_SIZE * Constants.METER_TO_WORLD\r\n      );\r\n    }\r\n    this.batch.end();\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}