{"ast":null,"code":"\"use strict\";\n\nvar createThunk = require(\"./lib/thunk.js\");\n\nfunction Procedure() {\n  this.argTypes = [];\n  this.shimArgs = [];\n  this.arrayArgs = [];\n  this.arrayBlockIndices = [];\n  this.scalarArgs = [];\n  this.offsetArgs = [];\n  this.offsetArgIndex = [];\n  this.indexArgs = [];\n  this.shapeArgs = [];\n  this.funcName = \"\";\n  this.pre = null;\n  this.body = null;\n  this.post = null;\n  this.debug = false;\n}\n\nfunction compileCwise(user_args) {\n  //Create procedure\n  var proc = new Procedure(); //Parse blocks\n\n  proc.pre = user_args.pre;\n  proc.body = user_args.body;\n  proc.post = user_args.post; //Parse arguments\n\n  var proc_args = user_args.args.slice(0);\n  proc.argTypes = proc_args;\n\n  for (var i = 0; i < proc_args.length; ++i) {\n    var arg_type = proc_args[i];\n\n    if (arg_type === \"array\" || typeof arg_type === \"object\" && arg_type.blockIndices) {\n      proc.argTypes[i] = \"array\";\n      proc.arrayArgs.push(i);\n      proc.arrayBlockIndices.push(arg_type.blockIndices ? arg_type.blockIndices : 0);\n      proc.shimArgs.push(\"array\" + i);\n\n      if (i < proc.pre.args.length && proc.pre.args[i].count > 0) {\n        throw new Error(\"cwise: pre() block may not reference array args\");\n      }\n\n      if (i < proc.post.args.length && proc.post.args[i].count > 0) {\n        throw new Error(\"cwise: post() block may not reference array args\");\n      }\n    } else if (arg_type === \"scalar\") {\n      proc.scalarArgs.push(i);\n      proc.shimArgs.push(\"scalar\" + i);\n    } else if (arg_type === \"index\") {\n      proc.indexArgs.push(i);\n\n      if (i < proc.pre.args.length && proc.pre.args[i].count > 0) {\n        throw new Error(\"cwise: pre() block may not reference array index\");\n      }\n\n      if (i < proc.body.args.length && proc.body.args[i].lvalue) {\n        throw new Error(\"cwise: body() block may not write to array index\");\n      }\n\n      if (i < proc.post.args.length && proc.post.args[i].count > 0) {\n        throw new Error(\"cwise: post() block may not reference array index\");\n      }\n    } else if (arg_type === \"shape\") {\n      proc.shapeArgs.push(i);\n\n      if (i < proc.pre.args.length && proc.pre.args[i].lvalue) {\n        throw new Error(\"cwise: pre() block may not write to array shape\");\n      }\n\n      if (i < proc.body.args.length && proc.body.args[i].lvalue) {\n        throw new Error(\"cwise: body() block may not write to array shape\");\n      }\n\n      if (i < proc.post.args.length && proc.post.args[i].lvalue) {\n        throw new Error(\"cwise: post() block may not write to array shape\");\n      }\n    } else if (typeof arg_type === \"object\" && arg_type.offset) {\n      proc.argTypes[i] = \"offset\";\n      proc.offsetArgs.push({\n        array: arg_type.array,\n        offset: arg_type.offset\n      });\n      proc.offsetArgIndex.push(i);\n    } else {\n      throw new Error(\"cwise: Unknown argument type \" + proc_args[i]);\n    }\n  } //Make sure at least one array argument was specified\n\n\n  if (proc.arrayArgs.length <= 0) {\n    throw new Error(\"cwise: No array arguments specified\");\n  } //Make sure arguments are correct\n\n\n  if (proc.pre.args.length > proc_args.length) {\n    throw new Error(\"cwise: Too many arguments in pre() block\");\n  }\n\n  if (proc.body.args.length > proc_args.length) {\n    throw new Error(\"cwise: Too many arguments in body() block\");\n  }\n\n  if (proc.post.args.length > proc_args.length) {\n    throw new Error(\"cwise: Too many arguments in post() block\");\n  } //Check debug flag\n\n\n  proc.debug = !!user_args.printCode || !!user_args.debug; //Retrieve name\n\n  proc.funcName = user_args.funcName || \"cwise\"; //Read in block size\n\n  proc.blockSize = user_args.blockSize || 64;\n  return createThunk(proc);\n}\n\nmodule.exports = compileCwise;","map":{"version":3,"names":["createThunk","require","Procedure","argTypes","shimArgs","arrayArgs","arrayBlockIndices","scalarArgs","offsetArgs","offsetArgIndex","indexArgs","shapeArgs","funcName","pre","body","post","debug","compileCwise","user_args","proc","proc_args","args","slice","i","length","arg_type","blockIndices","push","count","Error","lvalue","offset","array","printCode","blockSize","module","exports"],"sources":["D:/projects/test-game/node_modules/cwise-compiler/compiler.js"],"sourcesContent":["\"use strict\"\n\nvar createThunk = require(\"./lib/thunk.js\")\n\nfunction Procedure() {\n  this.argTypes = []\n  this.shimArgs = []\n  this.arrayArgs = []\n  this.arrayBlockIndices = []\n  this.scalarArgs = []\n  this.offsetArgs = []\n  this.offsetArgIndex = []\n  this.indexArgs = []\n  this.shapeArgs = []\n  this.funcName = \"\"\n  this.pre = null\n  this.body = null\n  this.post = null\n  this.debug = false\n}\n\nfunction compileCwise(user_args) {\n  //Create procedure\n  var proc = new Procedure()\n  \n  //Parse blocks\n  proc.pre    = user_args.pre\n  proc.body   = user_args.body\n  proc.post   = user_args.post\n\n  //Parse arguments\n  var proc_args = user_args.args.slice(0)\n  proc.argTypes = proc_args\n  for(var i=0; i<proc_args.length; ++i) {\n    var arg_type = proc_args[i]\n    if(arg_type === \"array\" || (typeof arg_type === \"object\" && arg_type.blockIndices)) {\n      proc.argTypes[i] = \"array\"\n      proc.arrayArgs.push(i)\n      proc.arrayBlockIndices.push(arg_type.blockIndices ? arg_type.blockIndices : 0)\n      proc.shimArgs.push(\"array\" + i)\n      if(i < proc.pre.args.length && proc.pre.args[i].count>0) {\n        throw new Error(\"cwise: pre() block may not reference array args\")\n      }\n      if(i < proc.post.args.length && proc.post.args[i].count>0) {\n        throw new Error(\"cwise: post() block may not reference array args\")\n      }\n    } else if(arg_type === \"scalar\") {\n      proc.scalarArgs.push(i)\n      proc.shimArgs.push(\"scalar\" + i)\n    } else if(arg_type === \"index\") {\n      proc.indexArgs.push(i)\n      if(i < proc.pre.args.length && proc.pre.args[i].count > 0) {\n        throw new Error(\"cwise: pre() block may not reference array index\")\n      }\n      if(i < proc.body.args.length && proc.body.args[i].lvalue) {\n        throw new Error(\"cwise: body() block may not write to array index\")\n      }\n      if(i < proc.post.args.length && proc.post.args[i].count > 0) {\n        throw new Error(\"cwise: post() block may not reference array index\")\n      }\n    } else if(arg_type === \"shape\") {\n      proc.shapeArgs.push(i)\n      if(i < proc.pre.args.length && proc.pre.args[i].lvalue) {\n        throw new Error(\"cwise: pre() block may not write to array shape\")\n      }\n      if(i < proc.body.args.length && proc.body.args[i].lvalue) {\n        throw new Error(\"cwise: body() block may not write to array shape\")\n      }\n      if(i < proc.post.args.length && proc.post.args[i].lvalue) {\n        throw new Error(\"cwise: post() block may not write to array shape\")\n      }\n    } else if(typeof arg_type === \"object\" && arg_type.offset) {\n      proc.argTypes[i] = \"offset\"\n      proc.offsetArgs.push({ array: arg_type.array, offset:arg_type.offset })\n      proc.offsetArgIndex.push(i)\n    } else {\n      throw new Error(\"cwise: Unknown argument type \" + proc_args[i])\n    }\n  }\n  \n  //Make sure at least one array argument was specified\n  if(proc.arrayArgs.length <= 0) {\n    throw new Error(\"cwise: No array arguments specified\")\n  }\n  \n  //Make sure arguments are correct\n  if(proc.pre.args.length > proc_args.length) {\n    throw new Error(\"cwise: Too many arguments in pre() block\")\n  }\n  if(proc.body.args.length > proc_args.length) {\n    throw new Error(\"cwise: Too many arguments in body() block\")\n  }\n  if(proc.post.args.length > proc_args.length) {\n    throw new Error(\"cwise: Too many arguments in post() block\")\n  }\n\n  //Check debug flag\n  proc.debug = !!user_args.printCode || !!user_args.debug\n  \n  //Retrieve name\n  proc.funcName = user_args.funcName || \"cwise\"\n  \n  //Read in block size\n  proc.blockSize = user_args.blockSize || 64\n\n  return createThunk(proc)\n}\n\nmodule.exports = compileCwise\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}