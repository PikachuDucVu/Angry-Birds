{"ast":null,"code":"import _initializerDefineProperty from \"D:/projects/test-game/node_modules/@babel/runtime/helpers/esm/initializerDefineProperty.js\";\nimport _applyDecoratedDescriptor from \"D:/projects/test-game/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor.js\";\nimport _initializerWarningHelper from \"D:/projects/test-game/node_modules/@babel/runtime/helpers/esm/initializerWarningHelper.js\";\n\nvar _dec, _dec2, _dec3, _dec4, _dec5, _dec6, _dec7, _class, _descriptor, _descriptor2, _descriptor3, _descriptor4, _descriptor5, _descriptor6, _descriptor7;\n\nimport { System, Inject } from \"flat-ecs\";\nimport { TextureRegion, Animation, PlayMode } from \"gdxts\";\nimport { Constants } from \"../Constants\";\nexport let BoxesAndPigsRenderSystem = (_dec = Inject(\"gl\"), _dec2 = Inject(\"assetManager\"), _dec3 = Inject(\"batch\"), _dec4 = Inject(\"boxes\"), _dec5 = Inject(\"pigs\"), _dec6 = Inject(\"physicWorld\"), _dec7 = Inject(\"levelState\"), (_class = class BoxesAndPigsRenderSystem extends System {\n  constructor() {\n    super(...arguments);\n    this.boxAsset = void 0;\n    this.pigAsset = void 0;\n    this.boxRegions = void 0;\n    this.pigRegions = void 0;\n    this.boxAnimation = void 0;\n    this.pigAnimation = void 0;\n\n    _initializerDefineProperty(this, \"gl\", _descriptor, this);\n\n    _initializerDefineProperty(this, \"assetManager\", _descriptor2, this);\n\n    _initializerDefineProperty(this, \"batch\", _descriptor3, this);\n\n    _initializerDefineProperty(this, \"boxes\", _descriptor4, this);\n\n    _initializerDefineProperty(this, \"pigs\", _descriptor5, this);\n\n    _initializerDefineProperty(this, \"physicWorld\", _descriptor6, this);\n\n    _initializerDefineProperty(this, \"levelState\", _descriptor7, this);\n  }\n\n  initialized() {\n    this.boxAsset = this.assetManager.getTexture(\"boxAsset\");\n    this.pigAsset = this.assetManager.getTexture(\"pigAsset\");\n    const boxesRegions = TextureRegion.splitTexture(this.boxAsset, 1, 4);\n    const pigTexture = TextureRegion.splitTexture(this.pigAsset, 2, 1);\n    this.boxAnimation = new Animation(boxesRegions.slice(0, 4), Constants.frameDuration);\n    this.pigAnimation = new Animation(pigTexture.slice(0, 2), Constants.frameDuration);\n    this.boxRegions = [this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL), this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL), this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL), this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL), this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL), this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL)];\n    this.pigRegions = [this.pigAnimation.getKeyFrame(0, PlayMode.NORMAL), this.pigAnimation.getKeyFrame(0, PlayMode.NORMAL)];\n  }\n\n  process() {\n    const updateBoxRegionByDurability = (index, durability) => {\n      this.boxRegions[index] = this.boxAnimation.getKeyFrame(Constants.frameDuration * durability, PlayMode.NORMAL);\n    };\n\n    const updatePigRegionByDurability = (index, durability) => {\n      this.pigRegions[index] = this.pigAnimation.getKeyFrame(Constants.frameDuration * durability, PlayMode.NORMAL);\n    };\n\n    for (let i = 0; i < this.boxes.length; i++) {\n      if (typeof this.boxes[i].GetUserData().durability === \"number\") {\n        if (this.boxes[i].GetUserData().durability <= 4) {\n          updateBoxRegionByDurability(i, this.boxes[i].GetUserData().durability);\n        }\n      }\n    }\n\n    for (let i = 0; i < this.pigs.length; i++) {\n      if (typeof this.pigs[i].GetUserData().durability === \"number\") {\n        if (this.pigs[i].GetUserData().durability <= 1) {\n          updatePigRegionByDurability(i, this.pigs[i].GetUserData().durability);\n        }\n      }\n    }\n\n    this.batch.begin();\n\n    for (let i = 0; i < this.boxes.length; i++) {\n      this.boxRegions[i].draw(this.batch, this.boxes[i].GetPosition().x * Constants.METER_TO_WORLD - Constants.BOX_SIZE * Constants.METER_TO_WORLD / 2, this.boxes[i].GetPosition().y * Constants.METER_TO_WORLD - Constants.BOX_SIZE * Constants.METER_TO_WORLD / 2, Constants.BOX_SIZE * Constants.METER_TO_WORLD, Constants.BOX_SIZE * Constants.METER_TO_WORLD);\n    }\n\n    for (let i = 0; i < this.pigs.length; i++) {\n      this.pigRegions[i].draw(this.batch, this.pigs[i].GetPosition().x * Constants.METER_TO_WORLD - Constants.PIG_SIZE * Constants.METER_TO_WORLD / 2, this.pigs[i].GetPosition().y * Constants.METER_TO_WORLD - Constants.PIG_SIZE * Constants.METER_TO_WORLD / 2, Constants.PIG_SIZE * Constants.METER_TO_WORLD, Constants.PIG_SIZE * Constants.METER_TO_WORLD);\n    }\n\n    this.batch.end();\n  }\n\n}, (_descriptor = _applyDecoratedDescriptor(_class.prototype, \"gl\", [_dec], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"assetManager\", [_dec2], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor3 = _applyDecoratedDescriptor(_class.prototype, \"batch\", [_dec3], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor4 = _applyDecoratedDescriptor(_class.prototype, \"boxes\", [_dec4], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor5 = _applyDecoratedDescriptor(_class.prototype, \"pigs\", [_dec5], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor6 = _applyDecoratedDescriptor(_class.prototype, \"physicWorld\", [_dec6], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor7 = _applyDecoratedDescriptor(_class.prototype, \"levelState\", [_dec7], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class));","map":{"version":3,"names":["System","Inject","TextureRegion","Animation","PlayMode","Constants","BoxesAndPigsRenderSystem","boxAsset","pigAsset","boxRegions","pigRegions","boxAnimation","pigAnimation","initialized","assetManager","getTexture","boxesRegions","splitTexture","pigTexture","slice","frameDuration","getKeyFrame","NORMAL","process","updateBoxRegionByDurability","index","durability","updatePigRegionByDurability","i","boxes","length","GetUserData","pigs","batch","begin","draw","GetPosition","x","METER_TO_WORLD","BOX_SIZE","y","PIG_SIZE","end"],"sources":["D:/projects/test-game/src/system/BoxesAndPigsRenderSystem.ts"],"sourcesContent":["import { b2Body, b2World } from \"box2d.ts\";\r\nimport { System, Inject } from \"flat-ecs\";\r\nimport {\r\n  AssetManager,\r\n  PolygonBatch,\r\n  Texture,\r\n  TextureRegion,\r\n  Animation,\r\n  PlayMode,\r\n} from \"gdxts\";\r\nimport { Constants } from \"../Constants\";\r\nimport { LevelState } from \"../data/LevelState\";\r\nexport class BoxesAndPigsRenderSystem extends System {\r\n  boxAsset: Texture;\r\n  pigAsset: Texture;\r\n  boxRegions: TextureRegion[];\r\n  pigRegions: TextureRegion[];\r\n  boxAnimation: any;\r\n  pigAnimation: any;\r\n\r\n  @Inject(\"gl\") gl: WebGLRenderingContext;\r\n  @Inject(\"assetManager\") assetManager: AssetManager;\r\n  @Inject(\"batch\") batch: PolygonBatch;\r\n  @Inject(\"boxes\") boxes: b2Body[];\r\n  @Inject(\"pigs\") pigs: b2Body[];\r\n  @Inject(\"physicWorld\") physicWorld: b2World;\r\n  @Inject(\"levelState\") levelState: LevelState;\r\n\r\n  initialized(): void {\r\n    this.boxAsset = this.assetManager.getTexture(\"boxAsset\") as Texture;\r\n    this.pigAsset = this.assetManager.getTexture(\"pigAsset\") as Texture;\r\n    const boxesRegions = TextureRegion.splitTexture(this.boxAsset, 1, 4);\r\n    const pigTexture = TextureRegion.splitTexture(this.pigAsset, 2, 1);\r\n    this.boxAnimation = new Animation(\r\n      boxesRegions.slice(0, 4),\r\n      Constants.frameDuration\r\n    );\r\n    this.pigAnimation = new Animation(\r\n      pigTexture.slice(0, 2),\r\n      Constants.frameDuration\r\n    );\r\n    this.boxRegions = [\r\n      this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n      this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n      this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n      this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n      this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n      this.boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n    ];\r\n    this.pigRegions = [\r\n      this.pigAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n      this.pigAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n    ];\r\n  }\r\n\r\n  process(): void {\r\n    const updateBoxRegionByDurability = (index: number, durability: number) => {\r\n      this.boxRegions[index] = this.boxAnimation.getKeyFrame(\r\n        Constants.frameDuration * durability,\r\n        PlayMode.NORMAL\r\n      );\r\n    };\r\n    const updatePigRegionByDurability = (index: number, durability: number) => {\r\n      this.pigRegions[index] = this.pigAnimation.getKeyFrame(\r\n        Constants.frameDuration * durability,\r\n        PlayMode.NORMAL\r\n      );\r\n    };\r\n\r\n    for (let i = 0; i < this.boxes.length; i++) {\r\n      if (typeof this.boxes[i].GetUserData().durability === \"number\") {\r\n        if (this.boxes[i].GetUserData().durability <= 4) {\r\n          updateBoxRegionByDurability(\r\n            i,\r\n            this.boxes[i].GetUserData().durability\r\n          );\r\n        }\r\n      }\r\n    }\r\n    for (let i = 0; i < this.pigs.length; i++) {\r\n      if (typeof this.pigs[i].GetUserData().durability === \"number\") {\r\n        if (this.pigs[i].GetUserData().durability <= 1) {\r\n          updatePigRegionByDurability(i, this.pigs[i].GetUserData().durability);\r\n        }\r\n      }\r\n    }\r\n\r\n    this.batch.begin();\r\n    for (let i = 0; i < this.boxes.length; i++) {\r\n      this.boxRegions[i].draw(\r\n        this.batch,\r\n        this.boxes[i].GetPosition().x * Constants.METER_TO_WORLD -\r\n          (Constants.BOX_SIZE * Constants.METER_TO_WORLD) / 2,\r\n        this.boxes[i].GetPosition().y * Constants.METER_TO_WORLD -\r\n          (Constants.BOX_SIZE * Constants.METER_TO_WORLD) / 2,\r\n        Constants.BOX_SIZE * Constants.METER_TO_WORLD,\r\n        Constants.BOX_SIZE * Constants.METER_TO_WORLD\r\n      );\r\n    }\r\n    for (let i = 0; i < this.pigs.length; i++) {\r\n      this.pigRegions[i].draw(\r\n        this.batch,\r\n        this.pigs[i].GetPosition().x * Constants.METER_TO_WORLD -\r\n          (Constants.PIG_SIZE * Constants.METER_TO_WORLD) / 2,\r\n        this.pigs[i].GetPosition().y * Constants.METER_TO_WORLD -\r\n          (Constants.PIG_SIZE * Constants.METER_TO_WORLD) / 2,\r\n        Constants.PIG_SIZE * Constants.METER_TO_WORLD,\r\n        Constants.PIG_SIZE * Constants.METER_TO_WORLD\r\n      );\r\n    }\r\n    this.batch.end();\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}