[{"D:\\projects\\test-game\\src\\index.ts":"1"},{"size":8871,"mtime":1660556449449,"results":"2","hashOfConfig":"3"},{"filePath":"4","messages":"5","suppressedMessages":"6","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"7"},"1wyhpi","D:\\projects\\test-game\\src\\index.ts",["8","9"],[],"import {\r\n  createGameLoop,\r\n  createStage,\r\n  createViewport,\r\n  PolygonBatch,\r\n  Texture,\r\n  BitmapFont,\r\n} from \"gdxts\";\r\n\r\nconst ROWS = 24;\r\nconst COLS = 12;\r\nconst GAME_WIDTH = 1500;\r\nconst GAME_HEIGHT = 2000;\r\n\r\nexport const init = async () => {\r\n  const stage = createStage();\r\n  const canvas = stage.getCanvas();\r\n  const viewport = createViewport(canvas, GAME_WIDTH, GAME_HEIGHT);\r\n  const gl = viewport.getContext();\r\n  const font = await BitmapFont.load(gl, \"./1231231.fnt\");\r\n  const batch = new PolygonBatch(gl);\r\n  const camera = viewport.getCamera();\r\n  batch.setYDown(true);\r\n  camera.setYDown(true);\r\n\r\n  const bgRight = await Texture.load(gl, \"./bg1.png\");\r\n  const block = await Texture.load(gl, \"./borderBlock.png\");\r\n  const mainBlock = await Texture.load(gl, \"./GreenBlock.png\");\r\n  const gameOverIcon = await Texture.load(gl, \"./gameover.png\");\r\n  const SQUARE_SIZE = 83;\r\n\r\n  let dropTime = 0;\r\n  let score = 0;\r\n  let gameover = false;\r\n\r\n  //tetrominoes\r\n  //I\r\n  const iBlock = [\r\n    [\r\n      [0, 0, 0, 0],\r\n      [1, 1, 1, 1],\r\n      [0, 0, 0, 0],\r\n      [0, 0, 0, 0],\r\n    ],\r\n    [\r\n      [0, 1, 0, 0],\r\n      [0, 1, 0, 0],\r\n      [0, 1, 0, 0],\r\n      [0, 1, 0, 0],\r\n    ],\r\n  ];\r\n\r\n  //L\r\n  const lBlock = [\r\n    [\r\n      [0, 0, 1],\r\n      [1, 1, 1],\r\n      [0, 0, 0],\r\n    ],\r\n    [\r\n      [0, 1, 0],\r\n      [0, 1, 0],\r\n      [0, 1, 1],\r\n    ],\r\n    [\r\n      [0, 0, 0],\r\n      [1, 1, 1],\r\n      [1, 0, 0],\r\n    ],\r\n    [\r\n      [1, 1, 0],\r\n      [0, 1, 0],\r\n      [0, 1, 0],\r\n    ],\r\n  ];\r\n\r\n  //L-reverse\r\n  const lReverseBlock = [\r\n    [\r\n      [1, 0, 0],\r\n      [1, 1, 1],\r\n      [0, 0, 0],\r\n    ],\r\n    [\r\n      [0, 1, 1],\r\n      [0, 1, 0],\r\n      [0, 1, 0],\r\n    ],\r\n    [\r\n      [0, 0, 0],\r\n      [1, 1, 1],\r\n      [0, 0, 1],\r\n    ],\r\n    [\r\n      [0, 1, 0],\r\n      [0, 1, 0],\r\n      [1, 1, 0],\r\n    ],\r\n  ];\r\n\r\n  // Square\r\n  const sBlock = [\r\n    [\r\n      [1, 1],\r\n      [1, 1],\r\n    ],\r\n  ];\r\n\r\n  // Z\r\n  const zBlock = [\r\n    [\r\n      [0, 1, 1],\r\n      [1, 1, 0],\r\n      [0, 0, 0],\r\n    ],\r\n    [\r\n      [0, 1, 0],\r\n      [0, 1, 1],\r\n      [0, 0, 1],\r\n    ],\r\n  ];\r\n\r\n  // Z-reverse\r\n  const zReverseBlock = [\r\n    [\r\n      [1, 1, 0],\r\n      [0, 1, 1],\r\n      [0, 0, 0],\r\n    ],\r\n    [\r\n      [0, 0, 1],\r\n      [0, 1, 1],\r\n      [0, 1, 0],\r\n    ],\r\n  ];\r\n\r\n  // T\r\n  const tBlock = [\r\n    [\r\n      [0, 1, 0],\r\n      [1, 1, 1],\r\n      [0, 0, 0],\r\n    ],\r\n    [\r\n      [0, 1, 0],\r\n      [0, 1, 1],\r\n      [0, 1, 0],\r\n    ],\r\n    [\r\n      [0, 0, 0],\r\n      [1, 1, 1],\r\n      [0, 1, 0],\r\n    ],\r\n    [\r\n      [0, 1, 0],\r\n      [1, 1, 0],\r\n      [0, 1, 0],\r\n    ],\r\n  ];\r\n  let speedGame = 0.5;\r\n  class Piece {\r\n    tetromino: any;\r\n    color: any;\r\n    tetrominoN: any;\r\n    activeTetromino: any;\r\n    temp: any;\r\n    x: number;\r\n    y: number;\r\n\r\n    constructor(tetromino: any, nextTetro?: any) {\r\n      this.tetromino = tetromino;\r\n      this.tetrominoN = 0;\r\n      this.activeTetromino = this.tetromino[this.tetrominoN];\r\n\r\n      this.x = 4;\r\n      this.y = 0;\r\n    }\r\n\r\n    fill(color?: any) {\r\n      for (let row = 0; row < this.activeTetromino.length; row++) {\r\n        for (let col = 0; col < this.activeTetromino.length; col++) {\r\n          if (this.activeTetromino[row][col]) {\r\n            drawSquare(this.x + col, this.y + row, color);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    draw() {\r\n      this.fill(1);\r\n    }\r\n    undraw() {\r\n      this.fill(0);\r\n    }\r\n\r\n    lock() {\r\n      for (let row = 0; row < this.activeTetromino.length; row++) {\r\n        for (let col = 0; col < this.activeTetromino.length; col++) {\r\n          if (!this.activeTetromino[row][col]) {\r\n            continue;\r\n          }\r\n          map[this.y + row][this.x + col] = 1;\r\n          //checkGameOver\r\n          if (this.y + row < 1) {\r\n            gameover = true;\r\n          }\r\n        }\r\n        // console.warn(map);\r\n      }\r\n\r\n      //checkpoint\r\n      for (let row = 0; row < ROWS; row++) {\r\n        let fullRow: boolean = true;\r\n        for (let col = 0; col < COLS; col++) {\r\n          fullRow = fullRow && map[row][col] !== 0;\r\n        }\r\n        if (fullRow) {\r\n          for (let y = row; y > 1; y--) {\r\n            for (let col = 0; col < COLS; col++) {\r\n              map[y][col] = map[y - 1][col];\r\n            }\r\n          }\r\n          for (let col = 0; col < COLS; col++) {\r\n            map[0][col] = 0;\r\n          }\r\n          if (speedGame > 0.15) {\r\n            speedGame -= 0.04;\r\n            console.log(speedGame);\r\n          }\r\n        }\r\n      }\r\n\r\n      score += 10;\r\n    }\r\n\r\n    collision(x: any, y: any, piece: any) {\r\n      for (let row = 0; row < piece.length; row++) {\r\n        for (let col = 0; col < piece.length; col++) {\r\n          if (!piece[row][col]) {\r\n            continue;\r\n          }\r\n          let newX = this.x + col + x;\r\n          let newY = this.y + row + y;\r\n\r\n          if (newX < 0 || newX >= COLS || newY >= ROWS) {\r\n            return true;\r\n          }\r\n\r\n          if (newY < 0) {\r\n            continue;\r\n          }\r\n          if (map[newY][newX] !== 0) {\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n\r\n    rotate() {\r\n      let nextRotateOfBlock =\r\n        this.tetromino[(this.tetrominoN + 1) % this.tetromino.length];\r\n      let kick = 0;\r\n      if (this.collision(0, 0, nextRotateOfBlock)) {\r\n        if (this.x > COLS / 2) {\r\n          kick = -1;\r\n        } else {\r\n          kick = 1;\r\n        }\r\n      }\r\n      if (!this.collision(kick, 0, nextRotateOfBlock)) {\r\n        this.undraw();\r\n        this.x += kick;\r\n        this.tetrominoN = (this.tetrominoN + 1) % this.tetromino.length;\r\n        this.activeTetromino = this.tetromino[this.tetrominoN];\r\n        this.draw();\r\n      }\r\n    }\r\n\r\n    moveDown() {\r\n      if (this.y >= 22) {\r\n        this.lock();\r\n        piece = new Piece(nextPiece);\r\n        nextPiece = blocks[getRandomInt(0, 6)];\r\n      }\r\n      if (!this.collision(0, 1, this.activeTetromino)) {\r\n        this.undraw();\r\n        this.y++;\r\n        this.draw();\r\n      } else {\r\n        this.lock();\r\n        piece = new Piece(nextPiece);\r\n        nextPiece = blocks[getRandomInt(0, 6)];\r\n      }\r\n    }\r\n    moveLeft() {\r\n      if (!this.collision(-1, 0, this.activeTetromino)) {\r\n        this.undraw();\r\n        this.x--;\r\n        this.draw();\r\n      }\r\n    }\r\n    moveRight() {\r\n      if (!this.collision(1, 0, this.activeTetromino)) {\r\n        this.undraw();\r\n        this.x++;\r\n        this.draw();\r\n      }\r\n    }\r\n    showNextTetromino(nextTetro: any) {\r\n      for (let row = 0; row < nextTetro.length; row++) {\r\n        for (let col = 0; col < nextTetro[row].length; col++) {\r\n          if (nextTetro[row][col]) {\r\n            drawSquare(13.4 + col, 3.2 + row, 1);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  let blocks = [\r\n    iBlock,\r\n    lBlock,\r\n    lReverseBlock,\r\n    tBlock,\r\n    sBlock,\r\n    zBlock,\r\n    zReverseBlock,\r\n  ];\r\n\r\n  let piece = new Piece(blocks[4]);\r\n  let nextPiece = blocks[getRandomInt(0, 6)];\r\n\r\n  window.addEventListener(\"keydown\", function (e) {\r\n    control(e);\r\n  });\r\n  function control(e: any) {\r\n    if (e.keyCode === 37) {\r\n      piece.moveLeft();\r\n    } else if (e.keyCode === 38) {\r\n      piece.rotate();\r\n    } else if (e.keyCode === 39) {\r\n      piece.moveRight();\r\n    } else if (e.keyCode === 40) {\r\n      piece.moveDown();\r\n      piece.moveDown();\r\n    }\r\n  }\r\n\r\n  function getRandomInt(min: number, max: number) {\r\n    return Math.floor(Math.random() * (max - min)) + min;\r\n  }\r\n\r\n  let map: any[] = [];\r\n  for (let row = 0; row < ROWS; row++) {\r\n    map[row] = [];\r\n    for (let col = 0; col < COLS; col++) {\r\n      drawSquare(col, row, 0);\r\n      map[row][col] = 0;\r\n    }\r\n  }\r\n  function drawMapGame() {\r\n    for (let row = 0; row < ROWS; row++) {\r\n      for (let col = 0; col < COLS; col++) {\r\n        drawSquare(col, row, map[row][col] === 1 ? 1 : 0);\r\n      }\r\n    }\r\n  }\r\n  function drawSquare(x: number, y: number, color?: any) {\r\n    batch.begin();\r\n    batch.draw(\r\n      color ? mainBlock : block, // 0 = gray // 1 = green\r\n      SQUARE_SIZE * x,\r\n      SQUARE_SIZE * y,\r\n      SQUARE_SIZE,\r\n      SQUARE_SIZE\r\n    );\r\n    batch.end();\r\n  }\r\n\r\n  createGameLoop((delta: number) => {\r\n    gl.clearColor(0, 0, 0, 1);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n    batch.setProjection(camera.projectionView.values);\r\n    drawMapGame();\r\n    batch.begin();\r\n    batch.draw(bgRight, 1000, 0, 500, 2000);\r\n    batch.end();\r\n    piece.fill(1);\r\n    piece.showNextTetromino(nextPiece[0]);\r\n    if (!gameover) {\r\n      dropTime += delta;\r\n      if (dropTime >= speedGame) {\r\n        dropTime = 0;\r\n        piece.moveDown();\r\n      }\r\n    } else {\r\n      batch.begin();\r\n\r\n      batch.draw(\r\n        gameOverIcon,\r\n        GAME_WIDTH / 2 - 760,\r\n        GAME_HEIGHT / 2 - 500,\r\n        1000,\r\n        1000\r\n      );\r\n      batch.end();\r\n    }\r\n  });\r\n};\r\ninit();\r\n",{"ruleId":"10","severity":1,"message":"11","line":20,"column":9,"nodeType":"12","messageId":"13","endLine":20,"endColumn":13},{"ruleId":"10","severity":1,"message":"14","line":233,"column":7,"nodeType":"12","messageId":"13","endLine":233,"endColumn":12},"@typescript-eslint/no-unused-vars","'font' is assigned a value but never used.","Identifier","unusedVar","'score' is assigned a value but never used."]