[{"D:\\projects\\test-game\\src\\index.ts":"1"},{"size":10811,"mtime":1662698561068,"results":"2","hashOfConfig":"3"},{"filePath":"4","messages":"5","suppressedMessages":"6","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"7"},"1wyhpi","D:\\projects\\test-game\\src\\index.ts",["8"],[],"import {\r\n  b2Body,\r\n  b2BodyDef,\r\n  b2BodyType,\r\n  b2CircleShape,\r\n  b2Contact,\r\n  b2ContactListener,\r\n  b2FixtureDef,\r\n  b2PolygonShape,\r\n  b2World,\r\n} from \"box2d.ts\";\r\nimport {\r\n  Animation,\r\n  Color,\r\n  createGameLoop,\r\n  createStage,\r\n  createViewport,\r\n  InputEvent,\r\n  PlayMode,\r\n  PolygonBatch,\r\n  ShapeRenderer,\r\n  Texture,\r\n  TextureRegion,\r\n  Vector2,\r\n  ViewportInputHandler,\r\n} from \"gdxts\";\r\n\r\nconst WORLD_WIDTH = 1300;\r\nconst WORLD_HEIGHT = 500;\r\n\r\nconst contactListener = new b2ContactListener();\r\n\r\nconst createWall = (\r\n  world: b2World,\r\n  x: number,\r\n  y: number,\r\n  width: number,\r\n  height: number\r\n) => {\r\n  const bodyDef = new b2BodyDef();\r\n  bodyDef.type = b2BodyType.b2_staticBody;\r\n  bodyDef.position.Set(x + width / 2, y + height / 2);\r\n  const body = world.CreateBody(bodyDef);\r\n  const shape = new b2PolygonShape();\r\n  shape.SetAsBox(width / 2, height / 2);\r\n  body.SetUserData(\"ground\");\r\n  body.CreateFixture(shape);\r\n};\r\n\r\nconst createBall = (\r\n  world: b2World,\r\n  x: number,\r\n  y: number,\r\n  radius: number\r\n): b2Body => {\r\n  const bodyDef = new b2BodyDef();\r\n  bodyDef.type = b2BodyType.b2_staticBody;\r\n  bodyDef.position.Set(x + radius / 2, y + radius / 2);\r\n  const circle = new b2CircleShape();\r\n  circle.m_radius = radius;\r\n  const fixtureDef = new b2FixtureDef();\r\n  fixtureDef.shape = circle;\r\n  // fixtureDef.density = 1;\r\n  fixtureDef.restitution = 0.5; // bounce ball\r\n  fixtureDef.friction = 1;\r\n  fixtureDef.shape = circle;\r\n  fixtureDef.userData = \"ballFixture\";\r\n\r\n  const body = world.CreateBody(bodyDef);\r\n  body.CreateFixture(fixtureDef);\r\n  body.SetUserData(\"ball\");\r\n  return body;\r\n};\r\n\r\nconst createBox = (\r\n  world: b2World,\r\n  x: number,\r\n  y: number,\r\n  width: number,\r\n  height: number,\r\n  userData: {\r\n    name: string;\r\n  }\r\n): b2Body => {\r\n  const bodyDef = new b2BodyDef();\r\n  bodyDef.type = b2BodyType.b2_dynamicBody;\r\n  bodyDef.position.Set(x + width / 2, y + height / 2);\r\n  const body = world.CreateBody(bodyDef);\r\n  const shape = new b2PolygonShape();\r\n  shape.SetAsBox(width * 0.5, height * 0.5);\r\n  body.SetUserData({\r\n    name: userData.name,\r\n    durability: 0,\r\n  });\r\n  body.CreateFixture(shape);\r\n  return body;\r\n};\r\n\r\nconst WALL_COLOR = new Color(0.5, 0.5, 0.5, 1);\r\nconst METER_TO_WORLD = 100;\r\n\r\nexport const init = async () => {\r\n  const stage = createStage();\r\n  const canvas = stage.getCanvas();\r\n  const viewport = createViewport(canvas, WORLD_WIDTH, WORLD_HEIGHT);\r\n  const gl = viewport.getContext();\r\n  const camera = viewport.getCamera();\r\n  const batch = new PolygonBatch(gl);\r\n\r\n  camera.setYDown(true);\r\n  batch.setYDown(true);\r\n\r\n  const bird = await Texture.load(gl, \"./bird.png\");\r\n  const slingShot = await Texture.load(gl, \"./slingshot.png\");\r\n  const background = await Texture.load(gl, \"./background.png\");\r\n  const pigAsset = await Texture.load(gl, \"./pigAsset.png\");\r\n  const mapData = await fetch(\"./untitled.tmj\").then((res) => res.json());\r\n  const wallData = mapData.layers.find((l: any) => l.name === \"walls\").objects;\r\n  const shapeRenderer = new ShapeRenderer(gl);\r\n  const world = new b2World({\r\n    x: 0,\r\n    y: 10,\r\n  });\r\n\r\n  const boxTexture = await Texture.load(gl, \"./testAnimation1.png\");\r\n  const boxesRegions = TextureRegion.splitTexture(boxTexture, 1, 4);\r\n  const pigTexture = await TextureRegion.splitTexture(pigAsset, 2, 1);\r\n\r\n  let frameDuration = 0.01;\r\n  const boxAnimation = new Animation(boxesRegions.slice(0, 4), frameDuration);\r\n  const pigAnimation = new Animation(pigTexture.slice(0, 2), frameDuration);\r\n\r\n  const boxRegions = [\r\n    boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n    boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n    boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n    boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n    boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n    boxAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n  ];\r\n  const pigRegions = [\r\n    pigAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n    pigAnimation.getKeyFrame(0, PlayMode.NORMAL),\r\n  ];\r\n\r\n  for (let wall of wallData) {\r\n    createWall(\r\n      world,\r\n      wall.x / METER_TO_WORLD,\r\n      wall.y / METER_TO_WORLD,\r\n      wall.width / METER_TO_WORLD,\r\n      wall.height / METER_TO_WORLD\r\n    );\r\n  }\r\n\r\n  const BOX_SIZE = 0.5;\r\n  const PIG_SIZE = 0.3;\r\n  const pigs: b2Body[] = [];\r\n  const boxes: b2Body[] = [];\r\n  let pigNumber = 0;\r\n  let boxNumber = 0;\r\n  let positionBoxX = 6;\r\n  let positionBoxY = 4.3;\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    positionBoxX = 6 + i * 0.4;\r\n    for (let j = 0; j <= i; j++) {\r\n      boxes.push(\r\n        createBox(\r\n          world,\r\n          (positionBoxX += 0.51),\r\n          (positionBoxY -= 0.55),\r\n          BOX_SIZE,\r\n          BOX_SIZE,\r\n          {\r\n            name: `box ${boxNumber++}`,\r\n          }\r\n        )\r\n      );\r\n    }\r\n    if (i < 2) {\r\n      pigs.push(\r\n        createBox(\r\n          world,\r\n          positionBoxX + 0.5,\r\n          positionBoxY - 0.25,\r\n          PIG_SIZE,\r\n          PIG_SIZE,\r\n          {\r\n            name: `pig ${pigNumber++}`,\r\n          }\r\n        )\r\n      );\r\n    }\r\n  }\r\n\r\n  const BALL_RADIUS = 0.2;\r\n  let ball = createBall(world, 2, 3.5, BALL_RADIUS);\r\n  let hasBirdOnSlingShot = true;\r\n  const originPosition = new Vector2(\r\n    ball.GetPosition().x * METER_TO_WORLD,\r\n    ball.GetPosition().y * METER_TO_WORLD\r\n  );\r\n  let slingPos = new Vector2(\r\n    ball.GetPosition().x * METER_TO_WORLD,\r\n    ball.GetPosition().y * METER_TO_WORLD\r\n  );\r\n\r\n  const inputHandler = new ViewportInputHandler(viewport);\r\n\r\n  inputHandler.addEventListener(InputEvent.TouchMove, () => {\r\n    if (inputHandler.isTouched()) {\r\n      slingPos = inputHandler.getTouchedWorldCoord();\r\n    }\r\n  });\r\n  inputHandler.addEventListener(InputEvent.TouchEnd, () => {\r\n    if (hasBirdOnSlingShot) {\r\n      ball.SetType(b2BodyType.b2_dynamicBody);\r\n      ball.ApplyLinearImpulseToCenter(\r\n        {\r\n          x: (7 * (originPosition.x - slingPos.x)) / METER_TO_WORLD,\r\n          y: (7 * (originPosition.y - slingPos.y)) / METER_TO_WORLD,\r\n        },\r\n        true\r\n      );\r\n      hasBirdOnSlingShot = false;\r\n    }\r\n  });\r\n  let delayTime = 0;\r\n\r\n  window.addEventListener(\"keydown\", function (e) {\r\n    if (!hasBirdOnSlingShot && e.key === \"r\") {\r\n      world.DestroyBody(ball);\r\n      ball = createBall(world, 2, 3.5, BALL_RADIUS);\r\n      hasBirdOnSlingShot = true;\r\n    }\r\n  });\r\n\r\n  gl.clearColor(0, 0, 0, 1);\r\n  contactListener.BeginContact = function (contact: b2Contact) {\r\n    if (delayTime >= 1) {\r\n      const fixtureAData = contact.GetFixtureA().GetBody().GetUserData();\r\n      const fixtureBData = contact.GetFixtureB().GetBody().GetUserData();\r\n\r\n      // if (fixtureBData !== \"ball\") return;\r\n\r\n      if (fixtureAData.name && fixtureAData.name.startsWith(\"box\")) {\r\n        fixtureAData.durability += 1;\r\n      }\r\n      if (fixtureAData.name && fixtureAData.name.startsWith(\"pig\")) {\r\n        fixtureAData.durability += 1;\r\n      }\r\n    }\r\n    // console.log(\r\n    //   contact.GetFixtureA().GetBody().GetUserData(),\r\n    //   contact.GetFixtureB().GetBody().GetUserData()\r\n    // );\r\n    // console.log(contact);\r\n  };\r\n\r\n  world.SetContactListener(contactListener);\r\n\r\n  const updateBoxRegionByDurability = (index: number, durability: number) => {\r\n    boxRegions[index] = boxAnimation.getKeyFrame(\r\n      frameDuration * durability,\r\n      PlayMode.NORMAL\r\n    );\r\n  };\r\n  const updatePigRegionByDurability = (index: number, durability: number) => {\r\n    pigRegions[index] = pigAnimation.getKeyFrame(\r\n      frameDuration * durability,\r\n      PlayMode.NORMAL\r\n    );\r\n  };\r\n  createGameLoop((delta: number) => {\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n    for (let i = 0; i < boxes.length; i++) {\r\n      const elementBox = boxes[i];\r\n      const boxDurability = elementBox.GetUserData().durability;\r\n      if (typeof boxDurability === \"number\") {\r\n        if (boxDurability <= 4) {\r\n          updateBoxRegionByDurability(i, boxDurability);\r\n        } else {\r\n          world.DestroyBody(boxes[i]);\r\n          boxes.splice(i, 1);\r\n        }\r\n      }\r\n    }\r\n    for (let i = 0; i < pigs.length; i++) {\r\n      const elementPig = pigs[i];\r\n      const pigDurability = elementPig.GetUserData().durability;\r\n      if (typeof pigDurability === \"number\") {\r\n        if (pigDurability <= 1) {\r\n          updatePigRegionByDurability(i, pigDurability);\r\n        } else {\r\n          world.DestroyBody(pigs[i]);\r\n          pigs.splice(i, 1);\r\n        }\r\n      }\r\n    }\r\n\r\n    world.Step(delta, 8, 3);\r\n    batch.setProjection(camera.combined);\r\n\r\n    shapeRenderer.setProjection(camera.combined);\r\n    shapeRenderer.begin();\r\n    shapeRenderer.rect(true, 0, 0, WORLD_WIDTH, WORLD_HEIGHT, Color.WHITE);\r\n\r\n    for (let wall of wallData) {\r\n      shapeRenderer.rect(\r\n        true,\r\n        wall.x,\r\n        wall.y,\r\n        wall.width,\r\n        wall.height,\r\n        WALL_COLOR\r\n      );\r\n    }\r\n    shapeRenderer.rect(\r\n      true,\r\n      2 * METER_TO_WORLD,\r\n      3.5 * METER_TO_WORLD,\r\n      0.25 * METER_TO_WORLD,\r\n      0.7 * METER_TO_WORLD,\r\n      Color.MAGENTA\r\n    );\r\n    shapeRenderer.circle(\r\n      true,\r\n      ball.GetPosition().x * METER_TO_WORLD,\r\n      ball.GetPosition().y * METER_TO_WORLD,\r\n      BALL_RADIUS * METER_TO_WORLD,\r\n      Color.RED\r\n    );\r\n    shapeRenderer.end();\r\n\r\n    batch.begin();\r\n    batch.draw(background, 0, 0, WORLD_WIDTH, WORLD_HEIGHT);\r\n    batch.end();\r\n\r\n    shapeRenderer.begin();\r\n    shapeRenderer.circle(\r\n      true,\r\n      slingPos.x,\r\n      slingPos.y,\r\n      0.1 * METER_TO_WORLD,\r\n      Color.BLUE\r\n    );\r\n\r\n    shapeRenderer.end();\r\n\r\n    batch.begin();\r\n\r\n    for (let i = 0; i < boxes.length; i++) {\r\n      boxRegions[i].draw(\r\n        batch,\r\n        boxes[i].GetPosition().x * METER_TO_WORLD -\r\n          (BOX_SIZE * METER_TO_WORLD) / 2,\r\n        boxes[i].GetPosition().y * METER_TO_WORLD -\r\n          (BOX_SIZE * METER_TO_WORLD) / 2,\r\n        BOX_SIZE * METER_TO_WORLD,\r\n        BOX_SIZE * METER_TO_WORLD\r\n      );\r\n    }\r\n\r\n    batch.draw(\r\n      slingShot,\r\n      2 * METER_TO_WORLD,\r\n      3.5 * METER_TO_WORLD,\r\n      0.25 * METER_TO_WORLD,\r\n      0.7 * METER_TO_WORLD\r\n    );\r\n    for (let i = 0; i < pigs.length; i++) {\r\n      pigRegions[i].draw(\r\n        batch,\r\n        pigs[i].GetPosition().x * METER_TO_WORLD -\r\n          (PIG_SIZE * METER_TO_WORLD) / 2,\r\n        pigs[i].GetPosition().y * METER_TO_WORLD -\r\n          (PIG_SIZE * METER_TO_WORLD) / 2,\r\n        PIG_SIZE * METER_TO_WORLD,\r\n        PIG_SIZE * METER_TO_WORLD\r\n      );\r\n    }\r\n    // console.log(box.GetContactList());\r\n\r\n    batch.draw(\r\n      bird,\r\n      ball.GetPosition().x * METER_TO_WORLD - 25,\r\n      ball.GetPosition().y * METER_TO_WORLD - 25,\r\n      BOX_SIZE * METER_TO_WORLD,\r\n      BOX_SIZE * METER_TO_WORLD\r\n    );\r\n\r\n    delayTime += delta;\r\n    batch.end();\r\n  });\r\n};\r\ninit();\r\n",{"ruleId":"9","severity":1,"message":"10","line":243,"column":13,"nodeType":"11","messageId":"12","endLine":243,"endColumn":25},"@typescript-eslint/no-unused-vars","'fixtureBData' is assigned a value but never used.","Identifier","unusedVar"]